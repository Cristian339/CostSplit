<ion-header class="ion-no-border">
  <ion-toolbar color="first">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <div class="logo-container">
        <img src="assets/icon/favicon.png" alt="CostSplit" class="logo">
        <span>CostSplitBD</span>
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="verPerfil()">
        <ion-icon slot="icon-only" name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="home-content">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div *ngIf="isLoading" class="loader-container">
    <ion-spinner name="crescent" color="secondary"></ion-spinner>
    <p>Cargando tus datos...</p>
  </div>

  <div *ngIf="!isLoading">
    <!-- Cabecera con saludo -->
    <div class="welcome-container">
      <div class="welcome-text">
        <h1>Hola, {{userName}}</h1>
        <p>¿Qué quieres hacer hoy?</p>
      </div>

      <div class="summary-card">
        <div>
          <h2>Resumen</h2>
          <p>Tienes {{grupos.length}} grupos activos</p>
        </div>
        <ion-button fill="clear" (click)="verInformes()" color="tertiary">
          Ver informes
          <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- Sección de grupos con carrusel -->
    <section class="section-container">
      <div class="section-header">
        <h2>Mis grupos</h2>
        <ion-button fill="clear" (click)="nuevoGrupo()" color="secondary">
          Nuevo
          <ion-icon name="add-circle-outline" slot="end"></ion-icon>
        </ion-button>
      </div>

      <div *ngIf="grupos.length === 0" class="empty-state">
        <ion-icon name="people-outline" size="large"></ion-icon>
        <h3>Aún no tienes grupos</h3>
        <p>Crea un grupo para comenzar a dividir gastos con amigos</p>
        <ion-button (click)="nuevoGrupo()" expand="block" color="secondary">
          Crear mi primer grupo
        </ion-button>
      </div>

      <!-- Carrusel de grupos usando el elemento swiper -->
      <swiper-container *ngIf="grupos.length > 0"
                        slides-per-view="1.2"
                        space-between="20"
                        centered-slides="true"
                        class="grupos-carousel">
        <swiper-slide *ngFor="let grupo of grupos">
          <ion-card class="grupo-card" (click)="verGrupo(grupo.id!)">
            <div class="grupo-card-header">
              <ion-icon name="people-outline"></ion-icon>
              <span>Creado el {{grupo.fechaCreacion | date:'dd MMM yyyy'}}</span>
            </div>
            <ion-card-header>
              <ion-card-title>{{grupo.nombre}}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p *ngIf="grupo.descripcion">{{grupo.descripcion}}</p>
              <p *ngIf="!grupo.descripcion" class="no-descripcion">Sin descripción</p>

              <div class="card-footer">
                <ion-button fill="outline" size="small" color="secondary">
                  Ver detalles
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </swiper-slide>
      </swiper-container>
    </section>

    <!-- Últimos gastos -->
    <section class="section-container" *ngIf="ultimosGastos.length > 0">
      <div class="section-header">
        <h2>Últimos gastos</h2>
        <ion-button fill="clear" [routerLink]="['/grupos', grupos[0].id, 'gastos']" *ngIf="grupos.length > 0" color="secondary">
          Ver todos
          <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
        </ion-button>
      </div>

      <ion-card class="transparent-card">
        <ion-list lines="none">
          <ion-item *ngFor="let gasto of ultimosGastos">
            <div slot="start" class="gasto-icon">
              <ion-icon [name]="getIconoTipoGasto(gasto.tipoGasto)"></ion-icon>
            </div>
            <ion-label>
              <h3>{{gasto.descripcion}}</h3>
              <p>{{gasto.fecha | date:'dd MMM yyyy'}}</p>
            </ion-label>
            <ion-note slot="end" class="amount-note">{{gasto.montoTotal | currency:gasto.divisa}}</ion-note>
          </ion-item>
        </ion-list>
      </ion-card>
    </section>

    <!-- Acciones rápidas -->
    <section class="section-container">
      <h2>Acciones rápidas</h2>
      <div class="actions-grid">
        <ion-card button (click)="nuevoGrupo()" class="action-card">
          <ion-icon name="people-outline" color="first"></ion-icon>
          <p>Nuevo grupo</p>
        </ion-card>
        <ion-card button [routerLink]="['/informes']" class="action-card">
          <ion-icon name="bar-chart-outline" color="secondary"></ion-icon>
          <p>Informes</p>
        </ion-card>
        <ion-card button [routerLink]="['/amigos']" class="action-card">
          <ion-icon name="person-outline" color="first"></ion-icon>
          <p>Mis amigos</p>
        </ion-card>
        <ion-card button [routerLink]="['/ayuda']" class="action-card" >
          <ion-icon name="help-circle-outline" color="secondary"></ion-icon>
          <p>Ayuda</p>
        </ion-card>
      </div>
    </section>
  </div>

  <!-- Flotante para crear nuevo grupo -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="secondary" (click)="nuevoGrupo()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
